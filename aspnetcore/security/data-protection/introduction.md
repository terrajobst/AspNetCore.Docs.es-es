---
title: ASP.NET Core protección de datos
author: rick-anderson
description: Obtenga información sobre el concepto de protección de datos y los principios de diseño de las API de protección de datos de ASP.NET Core.
ms.author: riande
ms.custom: mvc
ms.date: 10/24/2018
uid: security/data-protection/introduction
ms.openlocfilehash: 37f170a3e8a46ef2215b0999358d46dd402636df
ms.sourcegitcommit: 9a129f5f3e31cc449742b164d5004894bfca90aa
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78653843"
---
# <a name="aspnet-core-data-protection"></a><span data-ttu-id="f4515-103">ASP.NET Core protección de datos</span><span class="sxs-lookup"><span data-stu-id="f4515-103">ASP.NET Core Data Protection</span></span>

<span data-ttu-id="f4515-104">Las aplicaciones web suelen necesitar almacenar datos confidenciales de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f4515-104">Web applications often need to store security-sensitive data.</span></span> <span data-ttu-id="f4515-105">Windows proporciona DPAPI para las aplicaciones de escritorio, pero no es adecuado para las aplicaciones Web.</span><span class="sxs-lookup"><span data-stu-id="f4515-105">Windows provides DPAPI for desktop applications but this is unsuitable for web applications.</span></span> <span data-ttu-id="f4515-106">La ASP.NET Core pila de protección de datos proporciona una API criptográfica sencilla y fácil de usar que un desarrollador puede usar para proteger los datos, incluida la administración y la rotación de claves.</span><span class="sxs-lookup"><span data-stu-id="f4515-106">The ASP.NET Core data protection stack provide a simple, easy to use cryptographic API a developer can use to protect data, including key management and rotation.</span></span>

<span data-ttu-id="f4515-107">La ASP.NET Core pila de protección de datos está diseñada para servir como reemplazo a largo plazo para el elemento &lt;machineKey&gt; en ASP.NET 1. x-4. x.</span><span class="sxs-lookup"><span data-stu-id="f4515-107">The ASP.NET Core data protection stack is designed to serve as the long-term replacement for the &lt;machineKey&gt; element in ASP.NET 1.x - 4.x.</span></span> <span data-ttu-id="f4515-108">Se diseñó para abordar muchas de las deficiencias de la pila criptográfica anterior y, al mismo tiempo, proporciona una solución integrada para la mayoría de los casos de uso que es probable que se encuentren las aplicaciones modernas.</span><span class="sxs-lookup"><span data-stu-id="f4515-108">It was designed to address many of the shortcomings of the old cryptographic stack while providing an out-of-the-box solution for the majority of use cases modern applications are likely to encounter.</span></span>

## <a name="problem-statement"></a><span data-ttu-id="f4515-109">Declaración del problema</span><span class="sxs-lookup"><span data-stu-id="f4515-109">Problem statement</span></span>

<span data-ttu-id="f4515-110">La declaración del problema general se puede indicar sucintamente en una sola frase: necesito conservar información de confianza para su recuperación posterior, pero no confío en el mecanismo de persistencia.</span><span class="sxs-lookup"><span data-stu-id="f4515-110">The overall problem statement can be succinctly stated in a single sentence: I need to persist trusted information for later retrieval, but I don't trust the persistence mechanism.</span></span> <span data-ttu-id="f4515-111">En términos Web, esto podría escribirse como "Necesito un estado de confianza de ida y vuelta a través de un cliente que no es de confianza".</span><span class="sxs-lookup"><span data-stu-id="f4515-111">In web terms, this might be written as "I need to round-trip trusted state via an untrusted client."</span></span>

<span data-ttu-id="f4515-112">El ejemplo canónico de esto es una cookie de autenticación o un token de portador.</span><span class="sxs-lookup"><span data-stu-id="f4515-112">The canonical example of this is an authentication cookie or bearer token.</span></span> <span data-ttu-id="f4515-113">El servidor genera un token "soy Groot y tiene permisos XYZ" y lo entrega al cliente.</span><span class="sxs-lookup"><span data-stu-id="f4515-113">The server generates an "I am Groot and have xyz permissions" token and hands it to the client.</span></span> <span data-ttu-id="f4515-114">En una fecha futura, el cliente presentará ese token de vuelta al servidor, pero el servidor necesita algún tipo de garantía de que el cliente no haya falsificado el token.</span><span class="sxs-lookup"><span data-stu-id="f4515-114">At some future date the client will present that token back to the server, but the server needs some kind of assurance that the client hasn't forged the token.</span></span> <span data-ttu-id="f4515-115">Por lo tanto, el primer requisito: autenticidad (también conocido como</span><span class="sxs-lookup"><span data-stu-id="f4515-115">Thus the first requirement: authenticity (a.k.a.</span></span> <span data-ttu-id="f4515-116">integridad, prueba de alteración).</span><span class="sxs-lookup"><span data-stu-id="f4515-116">integrity, tamper-proofing).</span></span>

<span data-ttu-id="f4515-117">Puesto que el servidor confía en el estado persistente, se prevé que este estado puede contener información específica del entorno operativo.</span><span class="sxs-lookup"><span data-stu-id="f4515-117">Since the persisted state is trusted by the server, we anticipate that this state might contain information that's specific to the operating environment.</span></span> <span data-ttu-id="f4515-118">Puede ser una ruta de acceso de archivo, un permiso, un identificador u otra referencia indirecta, o algún otro tipo de datos específicos del servidor.</span><span class="sxs-lookup"><span data-stu-id="f4515-118">This could be in the form of a file path, a permission, a handle or other indirect reference, or some other piece of server-specific data.</span></span> <span data-ttu-id="f4515-119">Por lo general, esta información no se debe divulgar a un cliente que no sea de confianza.</span><span class="sxs-lookup"><span data-stu-id="f4515-119">Such information should generally not be disclosed to an untrusted client.</span></span> <span data-ttu-id="f4515-120">Por lo tanto, el segundo requisito: confidencialidad.</span><span class="sxs-lookup"><span data-stu-id="f4515-120">Thus the second requirement: confidentiality.</span></span>

<span data-ttu-id="f4515-121">Por último, como los componentes de las aplicaciones modernas, lo que hemos visto es que los componentes individuales querrán aprovechar este sistema sin tener en cuenta otros componentes del sistema.</span><span class="sxs-lookup"><span data-stu-id="f4515-121">Finally, since modern applications are componentized, what we've seen is that individual components will want to take advantage of this system without regard to other components in the system.</span></span> <span data-ttu-id="f4515-122">Por ejemplo, si un componente de token de portador usa esta pila, debe funcionar sin interferencias de un mecanismo anti-CSRF que también podría estar usando la misma pila.</span><span class="sxs-lookup"><span data-stu-id="f4515-122">For instance, if a bearer token component is using this stack, it should operate without interference from an anti-CSRF mechanism that might also be using the same stack.</span></span> <span data-ttu-id="f4515-123">Por lo tanto, el requisito final: aislamiento.</span><span class="sxs-lookup"><span data-stu-id="f4515-123">Thus the final requirement: isolation.</span></span>

<span data-ttu-id="f4515-124">Podemos proporcionar más restricciones para limitar el ámbito de nuestros requisitos.</span><span class="sxs-lookup"><span data-stu-id="f4515-124">We can provide further constraints in order to narrow the scope of our requirements.</span></span> <span data-ttu-id="f4515-125">Damos por hecho que todos los servicios que operan dentro de los Cryptosystem son de confianza y que no es necesario que los datos se generen o consuman fuera de los servicios bajo nuestro control directo.</span><span class="sxs-lookup"><span data-stu-id="f4515-125">We assume that all services operating within the cryptosystem are equally trusted and that the data doesn't need to be generated or consumed outside of the services under our direct control.</span></span> <span data-ttu-id="f4515-126">Además, es necesario que las operaciones sean lo más rápidas posible, ya que cada solicitud al servicio web puede pasar por el Cryptosystem una o varias veces.</span><span class="sxs-lookup"><span data-stu-id="f4515-126">Furthermore, we require that operations are as fast as possible since each request to the web service might go through the cryptosystem one or more times.</span></span> <span data-ttu-id="f4515-127">Esto hace que la criptografía simétrica sea ideal para nuestro escenario, y podemos usar la criptografía asimétrica hasta el momento en que sea necesario.</span><span class="sxs-lookup"><span data-stu-id="f4515-127">This makes symmetric cryptography ideal for our scenario, and we can discount asymmetric cryptography until such a time that it's needed.</span></span>

## <a name="design-philosophy"></a><span data-ttu-id="f4515-128">Filosofía de diseño</span><span class="sxs-lookup"><span data-stu-id="f4515-128">Design philosophy</span></span>

<span data-ttu-id="f4515-129">Comenzamos por identificar problemas con la pila existente.</span><span class="sxs-lookup"><span data-stu-id="f4515-129">We started by identifying problems with the existing stack.</span></span> <span data-ttu-id="f4515-130">Una vez hecho esto, se ha reparado el panorama de las soluciones existentes y se ha concluido que ninguna solución existente tiene las funcionalidades que buscamos.</span><span class="sxs-lookup"><span data-stu-id="f4515-130">Once we had that, we surveyed the landscape of existing solutions and concluded that no existing solution quite had the capabilities we sought.</span></span> <span data-ttu-id="f4515-131">A continuación, hemos diseñado una solución basada en varios principios de GUID.</span><span class="sxs-lookup"><span data-stu-id="f4515-131">We then engineered a solution based on several guiding principles.</span></span>

* <span data-ttu-id="f4515-132">El sistema debe ofrecer simplicidad de configuración.</span><span class="sxs-lookup"><span data-stu-id="f4515-132">The system should offer simplicity of configuration.</span></span> <span data-ttu-id="f4515-133">Idealmente, el sistema sería de configuración cero y los desarrolladores podían llegar al suelo.</span><span class="sxs-lookup"><span data-stu-id="f4515-133">Ideally the system would be zero-configuration and developers could hit the ground running.</span></span> <span data-ttu-id="f4515-134">En situaciones en las que los desarrolladores necesitan configurar un aspecto específico (como el repositorio de claves), se debe tener en cuenta que las configuraciones específicas son sencillas.</span><span class="sxs-lookup"><span data-stu-id="f4515-134">In situations where developers need to configure a specific aspect (such as the key repository), consideration should be given to making those specific configurations simple.</span></span>

* <span data-ttu-id="f4515-135">Ofrezca una API sencilla orientada al consumidor.</span><span class="sxs-lookup"><span data-stu-id="f4515-135">Offer a simple consumer-facing API.</span></span> <span data-ttu-id="f4515-136">Las API deben ser fáciles de usar correctamente y difíciles de usar de forma incorrecta.</span><span class="sxs-lookup"><span data-stu-id="f4515-136">The APIs should be easy to use correctly and difficult to use incorrectly.</span></span>

* <span data-ttu-id="f4515-137">Los desarrolladores no deben aprender principios de administración de claves.</span><span class="sxs-lookup"><span data-stu-id="f4515-137">Developers shouldn't learn key management principles.</span></span> <span data-ttu-id="f4515-138">El sistema debe controlar la selección del algoritmo y la duración de la clave en nombre del desarrollador.</span><span class="sxs-lookup"><span data-stu-id="f4515-138">The system should handle algorithm selection and key lifetime on the developer's behalf.</span></span> <span data-ttu-id="f4515-139">Idealmente, el desarrollador nunca debería tener acceso al material de clave sin procesar.</span><span class="sxs-lookup"><span data-stu-id="f4515-139">Ideally the developer should never even have access to the raw key material.</span></span>

* <span data-ttu-id="f4515-140">Las claves deben protegerse en reposo siempre que sea posible.</span><span class="sxs-lookup"><span data-stu-id="f4515-140">Keys should be protected at rest when possible.</span></span> <span data-ttu-id="f4515-141">El sistema debe averiguar un mecanismo de protección predeterminado adecuado y aplicarlo automáticamente.</span><span class="sxs-lookup"><span data-stu-id="f4515-141">The system should figure out an appropriate default protection mechanism and apply it automatically.</span></span>

<span data-ttu-id="f4515-142">Teniendo en cuenta estos principios, desarrollamos una pila de protección de datos sencilla y [fácil de usar](xref:security/data-protection/using-data-protection) .</span><span class="sxs-lookup"><span data-stu-id="f4515-142">With these principles in mind we developed a simple, [easy to use](xref:security/data-protection/using-data-protection) data protection stack.</span></span>

<span data-ttu-id="f4515-143">Las API de protección de datos de ASP.NET Core no están pensadas principalmente para la persistencia indefinida de cargas confidenciales.</span><span class="sxs-lookup"><span data-stu-id="f4515-143">The ASP.NET Core data protection APIs are not primarily intended for indefinite persistence of confidential payloads.</span></span> <span data-ttu-id="f4515-144">Otras tecnologías, como [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) y [Azure Rights Management](/rights-management/) , son más adecuadas para el escenario de almacenamiento indefinido, y tienen una sólida funcionalidad de administración de claves.</span><span class="sxs-lookup"><span data-stu-id="f4515-144">Other technologies like [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) and [Azure Rights Management](/rights-management/) are more suited to the scenario of indefinite storage, and they have correspondingly strong key management capabilities.</span></span> <span data-ttu-id="f4515-145">Dicho esto, no hay nada que prohíba a un desarrollador usar las API de protección de datos ASP.NET Core para la protección a largo plazo de datos confidenciales.</span><span class="sxs-lookup"><span data-stu-id="f4515-145">That said, there's nothing prohibiting a developer from using the ASP.NET Core data protection APIs for long-term protection of confidential data.</span></span>

## <a name="audience"></a><span data-ttu-id="f4515-146">Público</span><span class="sxs-lookup"><span data-stu-id="f4515-146">Audience</span></span>

<span data-ttu-id="f4515-147">El sistema de protección de datos se divide en cinco paquetes principales.</span><span class="sxs-lookup"><span data-stu-id="f4515-147">The data protection system is divided into five main packages.</span></span> <span data-ttu-id="f4515-148">Varios aspectos de estas API se dirigen a tres audiencias principales;</span><span class="sxs-lookup"><span data-stu-id="f4515-148">Various aspects of these APIs target three main audiences;</span></span>

1. <span data-ttu-id="f4515-149">La [información general sobre las API de consumidor](xref:security/data-protection/consumer-apis/overview) se dirige a los desarrolladores de aplicaciones y marcos.</span><span class="sxs-lookup"><span data-stu-id="f4515-149">The [Consumer APIs Overview](xref:security/data-protection/consumer-apis/overview) target application and framework developers.</span></span>

   <span data-ttu-id="f4515-150">"No deseo obtener información sobre cómo funciona la pila o sobre cómo se configura.</span><span class="sxs-lookup"><span data-stu-id="f4515-150">"I don't want to learn about how the stack operates or about how it's configured.</span></span> <span data-ttu-id="f4515-151">Simplemente deseo realizar alguna operación de la manera más sencilla posible con una alta probabilidad de usar las API correctamente ".</span><span class="sxs-lookup"><span data-stu-id="f4515-151">I simply want to perform some operation in as simple a manner as possible with high probability of using the APIs successfully."</span></span>

2. <span data-ttu-id="f4515-152">Las [API de configuración](xref:security/data-protection/configuration/overview) se dirigen a los desarrolladores de aplicaciones y administradores del sistema.</span><span class="sxs-lookup"><span data-stu-id="f4515-152">The [configuration APIs](xref:security/data-protection/configuration/overview) target application developers and system administrators.</span></span>

   <span data-ttu-id="f4515-153">"Necesito indicar al sistema de protección de datos que mi entorno requiere rutas de acceso o valores no predeterminados".</span><span class="sxs-lookup"><span data-stu-id="f4515-153">"I need to tell the data protection system that my environment requires non-default paths or settings."</span></span>

3. <span data-ttu-id="f4515-154">Las API de extensibilidad se dirigen a los desarrolladores a cargo de la implementación de una directiva personalizada.</span><span class="sxs-lookup"><span data-stu-id="f4515-154">The extensibility APIs target developers in charge of implementing custom policy.</span></span> <span data-ttu-id="f4515-155">El uso de estas API se limitaría a situaciones poco frecuentes y a desarrolladores con reconocimiento de seguridad experimentados.</span><span class="sxs-lookup"><span data-stu-id="f4515-155">Usage of these APIs would be limited to rare situations and experienced, security aware developers.</span></span>

   <span data-ttu-id="f4515-156">"Necesito reemplazar un componente completo en el sistema porque tengo requisitos de comportamiento realmente únicos.</span><span class="sxs-lookup"><span data-stu-id="f4515-156">"I need to replace an entire component within the system because I have truly unique behavioral requirements.</span></span> <span data-ttu-id="f4515-157">Estoy dispuesto a aprender partes que no se usan de forma habitual de la superficie de la API para crear un complemento que satisfaga mis requisitos ".</span><span class="sxs-lookup"><span data-stu-id="f4515-157">I am willing to learn uncommonly-used parts of the API surface in order to build a plugin that fulfills my requirements."</span></span>

## <a name="package-layout"></a><span data-ttu-id="f4515-158">Diseño del paquete</span><span class="sxs-lookup"><span data-stu-id="f4515-158">Package layout</span></span>

<span data-ttu-id="f4515-159">La pila de protección de datos consta de cinco paquetes.</span><span class="sxs-lookup"><span data-stu-id="f4515-159">The data protection stack consists of five packages.</span></span>

* <span data-ttu-id="f4515-160">[Microsoft. AspNetCore. bioprotection. Abstractions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) contiene las interfaces <xref:Microsoft.AspNetCore.DataProtection.IDataProtectionProvider> y <xref:Microsoft.AspNetCore.DataProtection.IDataProtector> para crear servicios de protección de datos.</span><span class="sxs-lookup"><span data-stu-id="f4515-160">[Microsoft.AspNetCore.DataProtection.Abstractions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) contains the <xref:Microsoft.AspNetCore.DataProtection.IDataProtectionProvider> and <xref:Microsoft.AspNetCore.DataProtection.IDataProtector> interfaces to create data protection services.</span></span> <span data-ttu-id="f4515-161">También contiene métodos de extensión útiles para trabajar con estos tipos (por ejemplo, [IDataProtector. Protect](xref:Microsoft.AspNetCore.DataProtection.DataProtectionCommonExtensions.Protect*)).</span><span class="sxs-lookup"><span data-stu-id="f4515-161">It also contains useful extension methods for working with these types (for example, [IDataProtector.Protect](xref:Microsoft.AspNetCore.DataProtection.DataProtectionCommonExtensions.Protect*)).</span></span> <span data-ttu-id="f4515-162">Si se crea una instancia del sistema de protección de datos en otra parte y está consumiendo la API, haga referencia `Microsoft.AspNetCore.DataProtection.Abstractions`.</span><span class="sxs-lookup"><span data-stu-id="f4515-162">If the data protection system is instantiated elsewhere and you're consuming the API, reference `Microsoft.AspNetCore.DataProtection.Abstractions`.</span></span>

* <span data-ttu-id="f4515-163">[Microsoft. AspNetCore. PROTECCION](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection/) contiene la implementación básica del sistema de protección de datos, incluidas las operaciones criptográficas principales, la administración de claves, la configuración y la extensibilidad.</span><span class="sxs-lookup"><span data-stu-id="f4515-163">[Microsoft.AspNetCore.DataProtection](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection/) contains the core implementation of the data protection system, including core cryptographic operations, key management, configuration, and extensibility.</span></span> <span data-ttu-id="f4515-164">Para crear una instancia del sistema de protección de datos (por ejemplo, agregarlo a un <xref:Microsoft.Extensions.DependencyInjection.IServiceCollection>) o modificar o ampliar su comportamiento, haga referencia a `Microsoft.AspNetCore.DataProtection`.</span><span class="sxs-lookup"><span data-stu-id="f4515-164">To instantiate the data protection system (for example, adding it to an <xref:Microsoft.Extensions.DependencyInjection.IServiceCollection>) or modifying or extending its behavior, reference `Microsoft.AspNetCore.DataProtection`.</span></span>

* <span data-ttu-id="f4515-165">[Microsoft. AspNetCore. PROTECCION. Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) contiene API adicionales que los desarrolladores pueden encontrar útiles pero que no pertenecen al paquete principal.</span><span class="sxs-lookup"><span data-stu-id="f4515-165">[Microsoft.AspNetCore.DataProtection.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) contains additional APIs which developers might find useful but which don't belong in the core package.</span></span> <span data-ttu-id="f4515-166">Por ejemplo, este paquete contiene métodos de generador para crear instancias del sistema de protección de datos para almacenar las claves en una ubicación del sistema de archivos sin la inserción de dependencias (vea <xref:Microsoft.AspNetCore.DataProtection.DataProtectionProvider>).</span><span class="sxs-lookup"><span data-stu-id="f4515-166">For instance, this package contains factory methods to instantiate the data protection system to store keys at a location on the file system without dependency injection (see <xref:Microsoft.AspNetCore.DataProtection.DataProtectionProvider>).</span></span> <span data-ttu-id="f4515-167">También contiene métodos de extensión para limitar la duración de las cargas protegidas (vea <xref:Microsoft.AspNetCore.DataProtection.ITimeLimitedDataProtector>).</span><span class="sxs-lookup"><span data-stu-id="f4515-167">It also contains extension methods for limiting the lifetime of protected payloads (see <xref:Microsoft.AspNetCore.DataProtection.ITimeLimitedDataProtector>).</span></span>

* <span data-ttu-id="f4515-168">[Microsoft. AspNetCore. DataDirect. SystemWeb](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.SystemWeb/) se puede instalar en una aplicación ASP.net 4. x existente para redirigir sus operaciones de `<machineKey>` para usar la nueva pila de protección de datos ASP.net Core.</span><span class="sxs-lookup"><span data-stu-id="f4515-168">[Microsoft.AspNetCore.DataProtection.SystemWeb](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.SystemWeb/) can be installed into an existing ASP.NET 4.x app to redirect its `<machineKey>` operations to use the new ASP.NET Core data protection stack.</span></span> <span data-ttu-id="f4515-169">Para más información, consulte <xref:security/data-protection/compatibility/replacing-machinekey>.</span><span class="sxs-lookup"><span data-stu-id="f4515-169">For more information, see <xref:security/data-protection/compatibility/replacing-machinekey>.</span></span>

* <span data-ttu-id="f4515-170">[Microsoft. AspNetCore. Cryptography. derivación](https://www.nuget.org/packages/Microsoft.AspNetCore.Cryptography.KeyDerivation/) proporciona una implementación de la rutina de hash de contraseña PBKDF2 y la pueden usar los sistemas que deben administrar las contraseñas de usuario de forma segura.</span><span class="sxs-lookup"><span data-stu-id="f4515-170">[Microsoft.AspNetCore.Cryptography.KeyDerivation](https://www.nuget.org/packages/Microsoft.AspNetCore.Cryptography.KeyDerivation/) provides an implementation of the PBKDF2 password hashing routine and can be used by systems that must handle user passwords securely.</span></span> <span data-ttu-id="f4515-171">Para más información, consulte <xref:security/data-protection/consumer-apis/password-hashing>.</span><span class="sxs-lookup"><span data-stu-id="f4515-171">For more information, see <xref:security/data-protection/consumer-apis/password-hashing>.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="f4515-172">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="f4515-172">Additional resources</span></span>

<xref:host-and-deploy/web-farm>
